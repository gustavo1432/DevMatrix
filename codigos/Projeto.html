<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editor de C√≥digo Autom√°tico</title>
  <link rel="icon" type="image/png"
    href="https://github.com/gustavo1432/portafolio-logo/blob/main/portfolio.png?raw=true">

  <!-- Monaco Editor CDN -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs/loader.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f1624;
      color: white;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    * {
      user-select: none;
    }

    header {
      padding: 10px 20px;
      background: #1a1a2e;
      text-align: center;
      font-size: 1.2rem;
      font-weight: bold;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #preview {
      width: 100%;
      border: none;
    }

    #editor-container {
      display: flex;
      flex-direction: column;
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    #editor {
      display: flex;
      flex: 1;
      gap: 5px;
    }

    .editor-pane {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .editor-pane label {
      background: #1a1a2e;
      padding: 5px;
      text-align: center;
      font-weight: bold;
    }

    .monaco-editor-container {
      flex: 1;
      border: 1px solid #333;
    }

    .menu-container {
      position: relative;
      display: inline-block;
    }

    .menu-button {
      background: #0f3460;
      border: none;
      color: white;
      padding: 6px 10px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 5px;
    }

    .menu-button:hover {
      background: #16213e;
    }

    .menu-dropdown {
      display: none;
      position: absolute;
      right: 0;
      background: #1a1a2e;
      border: 1px solid #333;
      border-radius: 5px;
      min-width: 120px;
      z-index: 10;
    }

    .menu-dropdown button {
      background: none;
      border: none;
      color: white;
      padding: 10px;
      text-align: left;
      width: 100%;
      cursor: pointer;
      font-size: 14px;
    }

    .menu-dropdown button:hover {
      background: #0f3460;
    }

    .menu-container.active .menu-dropdown {
      display: block;
    }

    #resizer {
      height: 5px;
      background: #333;
      cursor: pointer;
    }

    /* Caixa de coment√°rio flutuante */
    #resizer-comment {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 25px;
      background: #1a1a2e;
      color: #fff;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 0.9rem;
      opacity: 0.9;
      pointer-events: none;
      transition: opacity 0.5s ease;
      z-index: 5;
    }
  </style>
</head>

<body>
  <header>
    <div style="display:flex; align-items:center; cursor:pointer;" onclick="location.href='index.html'">
      <img src="https://github.com/gustavo1432/portafolio-logo/blob/main/portfolio.png?raw=true" alt="Logo"
        style="width:35px; height:35px; margin-right:8px;">
      <span style="font-weight:bold; font-size:1.2rem; color:white;">DevMatrix</span>
    </div>

    <div
      style="position:absolute; left:50%; transform:translateX(-50%); font-weight:bold; font-size:1.2rem; color:white;">
      Crie seu Site
    </div>

    <div class="menu-container" id="menu">
      <button class="menu-button">‚ò∞</button>
      <div class="menu-dropdown">
        <button onclick="salvarProjeto()">üíæ Salvar</button>
        <button onclick="listarProjetos()">üìÇ Listar</button>
        <button onclick="location.href='publish.html'">üöÄ Publicar</button>
      </div>
    </div>
  </header>

  <div id="editor-container">
    <iframe id="preview" style="height:300px;"></iframe>
    <div id="resizer-comment">üí° Clique na barra para ajustar o tamanho da pr√©via (Shift + clique para tela cheia)</div>
    <div id="resizer"></div>
    <div id="editor">
      <div class="editor-pane">
        <label>HTML</label>
        <div id="html-editor" class="monaco-editor-container"></div>
      </div>
      <div class="editor-pane">
        <label>CSS</label>
        <div id="css-editor" class="monaco-editor-container"></div>
      </div>
      <div class="editor-pane">
        <label>JS</label>
        <div id="js-editor" class="monaco-editor-container"></div>
      </div>
    </div>
  </div>

  <script>
    let htmlEditor, cssEditor, jsEditor;
    const preview = document.getElementById("preview");
    const editor = document.getElementById("editor");
    const editorContainer = document.getElementById("editor-container");
    const resizer = document.getElementById("resizer");
    const comment = document.getElementById("resizer-comment");
    const backendURL = "https://SEU_PROJETO.repl.co/projects";

    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs' } });

    require(['vs/editor/editor.main'], function () {
      htmlEditor = monaco.editor.create(document.getElementById('html-editor'), {
        value: '<h1>Hello World</h1>',
        language: 'html',
        theme: 'vs-dark',
        automaticLayout: true
      });

      cssEditor = monaco.editor.create(document.getElementById('css-editor'), {
        value: 'h1 { color: red; text-align: center; }',
        language: 'css',
        theme: 'vs-dark',
        automaticLayout: true
      });

      jsEditor = monaco.editor.create(document.getElementById('js-editor'), {
        value: 'console.log("Rodando JS!");',
        language: 'javascript',
        theme: 'vs-dark',
        automaticLayout: true
      });

      [htmlEditor, cssEditor, jsEditor].forEach(editor => {
        editor.onDidChangeModelContent(updatePreview);
      });

      updatePreview();
    });

    function updatePreview() {
      const html = htmlEditor.getValue();
      const css = "<style>" + cssEditor.getValue() + "</style>";
      const js = "<script>" + jsEditor.getValue() + "<\/script>";
      const doc = preview.contentDocument || preview.contentWindow.document;
      doc.open();
      doc.write(html + css + js);
      doc.close();
    }

    // ===== Fun√ß√µes integradas ao backend =====
    function salvarProjeto() {
      const name = prompt("Digite o nome do projeto:");
      if (!name) return alert("‚ùå Nome do projeto √© obrigat√≥rio!");
      const project = {
        name,
        code: htmlEditor.getValue() + "\n<style>" + cssEditor.getValue() + "</style>\n<script>" + jsEditor.getValue() + "<\/script>",
        language: "web",
        description: "Projeto criado no DevMatrix"
      };

      fetch(`${backendURL}/save`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(project)
      })
        .then(res => res.json())
        .then(data => alert("üíæ Projeto salvo com sucesso! ID: " + data.id))
        .catch(err => alert("‚ùå Erro ao salvar projeto: " + err));
    }

    function listarProjetos() {
      fetch(`${backendURL}/list`)
        .then(res => res.json())
        .then(projects => {
          if (projects.length === 0) return alert("üìÇ Nenhum projeto salvo!");
          let message = "Projetos salvos:\n";
          projects.forEach(p => message += `ID: ${p.id} | Nome: ${p.name}\n`);
          alert(message);
        })
        .catch(err => alert("‚ùå Erro ao listar projetos: " + err));
    }

    // ===== Clique na barra para ajustar propor√ß√£o ou tela cheia =====
    resizer.addEventListener('click', e => {
      if (e.shiftKey) {
        // Shift + clique = tela cheia
        preview.style.height = window.innerHeight - header.offsetHeight + "px";
        editor.style.height = "0px";
      } else {
        // Clique normal = metade da tela
        let half = (editorContainer.clientHeight - resizer.offsetHeight) / 2;
        preview.style.height = half + "px";
        editor.style.height = half + "px";
      }
    });

    // ===== Dica de coment√°rio flutuante =====
    window.addEventListener('load', () => {
      comment.style.opacity = 1;
      setTimeout(() => {
        comment.style.opacity = 0;
      }, 5000); // desaparece ap√≥s 5s
    });

    // Toggle menu
    document.getElementById("menu").addEventListener("click", function () {
      this.classList.toggle("active");
    });

    const header = document.querySelector('header');
  </script>
</body>

</html>
